# Takatomo Training Data Extractor

This tool extracts training data from Protocol Buffer (.pb) files generated by Takatomo training devices.

## Files in this folder

- **`training.proto`**: Protocol Buffer schema definition for the training data format
- **`*.pb`**: Binary training data files (Protocol Buffer format)
- **`extract_training_data.py`**: Python script to extract and convert the data
- **`requirements.txt`**: Python dependencies

## Quick Start

1. **Install dependencies:**
   ```bash
   pip install -r requirements.txt
   ```

2. **Run the extraction script:**
   ```bash
   python extract_training_data.py
   ```

## What the script does

The extraction script will:

1. **Compile the Protocol Buffer schema** (`training.proto`) to generate Python classes
2. **Parse all `.pb` files** in the current directory
3. **Generate three output files:**
   - `training_data.json` - Complete data in JSON format
   - `training_data.csv` - Summary data (one row per training session)
   - `training_logs.csv` - Detailed logs with timestamps and sensor data

## Data Structure

Based on the `training.proto` schema, each training file contains:

### Training Metadata
- **Start time**: POSIX timestamp when training began
- **Duration**: Training duration in seconds
- **Distance**: Total distance in meters
- **Type**: Training type (DISTANCE, TIME, INTERVAL, FREE)
- **Mode**: Training mode (ROWING, CYCLING)
- **Split distance**: Distance for interval training
- **Rest duration**: Rest time between intervals

### Training Logs
Each training session contains multiple log entries with:
- **Delta time**: Milliseconds since training start
- **Distance**: Distance traveled in meters
- **Stroke rate**: Rowing stroke rate or cycling cadence
- **Heart rate**: Current heart rate
- **GPS position**: Latitude/longitude (if GPS tracking enabled)

## Manual Extraction (Alternative)

If you prefer to work with the data manually:

1. **Install protobuf compiler:**
   ```bash
   # On macOS with Homebrew
   brew install protobuf
   
   # Or install via pip
   pip install protobuf
   ```

2. **Compile the schema:**
   ```bash
   protoc --python_out=. training.proto
   ```

3. **Use the generated `training_pb2.py`** in your own Python scripts

## Example Usage

```python
import training_pb2

# Read a training file
with open('20250516-154119.pb', 'rb') as f:
    training = training_pb2.Training()
    training.ParseFromString(f.read())

# Access the data
print(f"Training duration: {training.meta.duration} seconds")
print(f"Total distance: {training.meta.distance} meters")
print(f"Number of log entries: {len(training.logs)}")
```

## Troubleshooting

- **"protoc command not found"**: Install the Protocol Buffer compiler
- **"training_pb2.py not found"**: Run `protoc --python_out=. training.proto` first
- **Import errors**: Make sure you have installed the requirements with `pip install -r requirements.txt` 